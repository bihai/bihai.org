<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
  <title>使用 Git Hook 实现网站的自动部署</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="This is meta description">
  <meta name="author" content="Themefisher">
  <meta name="generator" content="Hugo 0.67.1" />

  <!-- plugins -->
  
  <link rel="stylesheet" href="http://bihai.org/css/bootstrap.min.css">
  
  <link rel="stylesheet" href="http://bihai.org/css/slick.css">
  
  <link rel="stylesheet" href="http://bihai.org/css/font-awesome.min.css">
  
  <link rel="stylesheet" href="http://bihai.org/css/animate.min.css">
  
  <link rel="stylesheet" href="http://bihai.org/css/venobox.css">
  
  <link rel="stylesheet" href="http://bihai.org/css/main.css">
  
  <link rel="stylesheet" href="http://bihai.org/css/responsive.css">
  

  <!--Favicon-->
  <link rel="shortcut icon" href="http://bihai.org/images/favicon.png" type="image/x-icon">
  <link rel="icon" href="http://bihai.org/images/favicon.png" type="image/x-icon">

</head><body>
<!-- preloader start -->
<div class="preloader">
  
</div>
<!-- preloader end -->
<!-- Navigation Start  -->

<nav class="navigation">
	<div class="container">
		<div class="block">
			<nav class="navbar navbar-default">
				<div class="container-fluid">
					
					<div class="navbar-header">
						<button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
							data-target="#bs-example-navbar-collapse-1">
							<span class="sr-only">Toggle navigation</span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
						<!-- logo -->
						<a class="navbar-brand" href="http://bihai.org/">
							<img class="img-responsive" src="http://bihai.org/images/logo.png" alt="bihai.org">
						</a>
						<!-- logo -->
					</div>

					
					<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
						<ul class="nav navbar-nav navbar-right" id="top-nav">
							
							<li><a href="http://bihai.org/#hero-area">Home</a></li>
							
							<li><a href="http://bihai.org/#about-us">About Us</a></li>
							
							<li><a href="http://bihai.org/#blog">Blog</a></li>
							
							<li><a href="http://bihai.org/#price">Price</a></li>
							
							<li><a href="http://bihai.org/#subscribe">News</a></li>
							
							<li><a href="http://bihai.org/#contact-us">Contact Us</a></li>
							
						</ul>
					</div>
					
				</div>
			</nav>
		</div>
	</div>
</nav><section class="section blog-single-page">
    <div class="container">
        <div class="row">
            <div class="col-md-8 col-md-offset-2 text-center">
                <img class="img-responsive post-thumb d-inline-block" src="http://bihai.org/" alt="blog-image">
                <h1 class="post-title">使用 Git Hook 实现网站的自动部署</h1>
                <ul class="list-inline mb-50 post-meta">
                    <li class="list-inline-item"></li>
                    <li class="list-inline-item">Monday, Jan 1, 0001</li>
                </ul>
            </div>
            <div class="col-md-8 col-md-offset-2">
                <div class="post-single-content">
                    <p>自动化能解放人类的双手，而且更重要的是，因为按照规定的流程来走，也减少了很多误操作的产生。不知道大家平时都是怎么样更新自己生产环境的代码的，FTP
覆盖旧文件、服务器定时任务去 build 最新的源码，还是有更高级的做法？</p>
<p>目前我在使用 Git Hook 来部署自己的项目。Git Hook 是 Git 提供的一个钩子，能被特定的事件触发后调用。其实，更通俗的讲，当你设置了
Git Hook 后，只要你的远程仓库收到一次 push 之后，Git Hook 就能帮你执行一次 bash 脚本。</p>
<p>下面是我使用 Git Hook 进行简单的自动化部署，可能还有更高级的做法，大家自己去挖掘。</p>
<p>在服务器初始化一个远程 Git 仓库</p>
<p>git init 和 git –bare init 初始化出来的仓库是完全不一样的，具体我 Google
了下，英文倒是理解了，但是要翻译出中文却不知道用什么形容词去称呼这2种仓库。</p>
<p>这里我们要通过 git –bare init 初始化一个远程仓库</p>
<pre><code>$ cd ~
$ mkdir testRepo
$ cd testRepo
$ git --bare init
</code></pre>
<p>在服务器初始化一个本地 Git 仓库</p>
<p>这个仓库就是通过 git init 初始化出来最常见的本地仓库，它的作用是拉去远程仓库（其实就在它旁边）最新的源码，然后在这个仓库里进行编译，把代码编译到
www 目录（网站的根目录）。</p>
<pre><code>$ cd ~
$ mkdir testRepo
$ cd testRepo
$ git --bare init
</code></pre>
<p>为远程仓库设置 Hook</p>
<pre><code>$ cd ~/testRepo/hooks
$ vim post-receive
</code></pre>
<p>post-receive 里面的执行脚本</p>
<pre><code>#!/bin/sh
unset GIT_DIR
DeployPath=/home/user/testDeploy
WwwPath=/home/wwwroot/testDeploy
cd $DeployPath
git add . -A &amp;&amp; git stash
git pull origin master
# 下面这2步都是按照实际你自己添加的bash脚本
fis release -Dompd $WwwPath # 我使用的FIS，对前端代码进行编译
qrsync /home/user/qiniutools/config.json # 使用七牛同步工具进行同步
</code></pre>
<p>最后，为 post-receive 添加可执行权限</p>
<pre><code>chmod +x post-receive
</code></pre>
<p>为本地仓库添加 remote 源</p>
<p>这次的本地仓库就真的是你开发机上面的本地了。在你原有 Git 项目里面添加一条新的 remote 源，以后往这个 remote 源里面 push
代码就会自动触发上面那 bash 脚本了。</p>
<pre><code>$ git remote add deploy user@server.ip:/home/user/testRepo
$ git push deploy master
</code></pre>
<ul>
<li><a href=""> 点赞  </a></li>
<li><a href=""> 收藏  </a></li>
<li><a href=""> 分享 </a></li>
<li>
<pre><code>* 文章举报 
</code></pre>
</li>
</ul>
<p><a href="https://blog.csdn.net/thriller"> <img src="https://profile.csdnimg.cn/2/1/1/3_thriller" alt="">
<img src="https://g.csdnimg.cn/static/user-reg-year/1x/20.png" alt="">
</a></p>
<p><a href="https://blog.csdn.net/thriller"> thriller </a></p>
<p>发布了19 篇原创文章  ·  获赞 18  ·  访问量 5万+</p>
<p><a href="https://im.csdn.net/im/main.html?userName=thriller"> 私信 </a> 关注</p>

                </div>
            </div>
        </div>
    </div>
</section>


<section id="footer">
	<div class="container">
		<div class="row">
			<div class="col-md-4">
				<div class="block wow fadeInLeft" data-wow-delay="200ms">
					<h3> CONTACT <span>INFO</span>  </h3>
					<div class="info">
						<ul>
							
							<li>
								<h4><i class="fa fa-phone"></i>Telephone</h4>
								<p>016742 323313</p>
							</li>
							
							<li>
								<h4><i class="fa fa-map-marker"></i>Address</h4>
								<p>2046 Blue Spruce Lane Laurel Canada</p>
							</li>
							
							<li>
								<h4><i class="fa fa-envelope"></i>E mail</h4>
								<p><a href="mailto:rest@gmail.com">rest@gmail.com</a> - <a href="mailto:rest@mail.ru">rest@mail.ru</a></p>
							</li>
							
						</ul>
					</div>
				</div>
			</div>
			
			<div class="col-md-4">
				<div class="block wow fadeInLeft" data-wow-delay="700ms">
					<h3> LATEST <span>BLOG POSTS</span> </h3>
					<div class="blog">
						<ul>
							
							<!-- post -->
							<li>
								<h4><a href="http://bihai.org/red-pepper-miso-wings-2/">Red Pepper Miso Wings 2</a></h4>
								<p>26 Dec 2018</p>
							</li>
							
							<!-- post -->
							<li>
								<h4><a href="http://bihai.org/red-pepper-miso-wings/">Red Pepper Miso Wings</a></h4>
								<p>26 Dec 2018</p>
							</li>
							
							<!-- post -->
							<li>
								<h4><a href="http://bihai.org/homestyle-chicken-pot-pie/">Homestyle Chicken Pot Pie</a></h4>
								<p>26 Dec 2018</p>
							</li>
							
						</ul>
					</div>
				</div>
			</div>
			
			<div class="col-md-4">
				<div class="block wow fadeInLeft" data-wow-delay="1100ms">
					<div class="gallary">
						<h3> PHOTO <span>STREAM</span> </h3>
						<ul class="gallery">
							
							<li><a href="http://bihai.org/images/slider/slider-img-1.jpg" class="venobox" data-gall="footerGallery"><img class="img-responsive"
										src="http://bihai.org/images/slider/slider-img-1.jpg" alt=""></a></li>
							
							<li><a href="http://bihai.org/images/slider/slider-img-2.jpg" class="venobox" data-gall="footerGallery"><img class="img-responsive"
										src="http://bihai.org/images/slider/slider-img-2.jpg" alt=""></a></li>
							
							<li><a href="http://bihai.org/images/slider/slider-img-3.jpg" class="venobox" data-gall="footerGallery"><img class="img-responsive"
										src="http://bihai.org/images/slider/slider-img-3.jpg" alt=""></a></li>
							
							<li><a href="http://bihai.org/images/slider/slider-img-4.jpg" class="venobox" data-gall="footerGallery"><img class="img-responsive"
										src="http://bihai.org/images/slider/slider-img-4.jpg" alt=""></a></li>
							
							<li><a href="http://bihai.org/images/slider/slider-img-1.jpg" class="venobox" data-gall="footerGallery"><img class="img-responsive"
										src="http://bihai.org/images/slider/slider-img-1.jpg" alt=""></a></li>
							
							<li><a href="http://bihai.org/images/slider/slider-img-2.jpg" class="venobox" data-gall="footerGallery"><img class="img-responsive"
										src="http://bihai.org/images/slider/slider-img-2.jpg" alt=""></a></li>
							
						</ul>
					</div>
					<div class="social-media-link">
						<h3> Follow <span>US</span> </h3>
						<ul>
							
							<li><a href="https://fb.com/themefisher"><i class="fa fa-facebook"></i></a></li>
							
							<li><a href="https://fb.com/themefisher"><i class="fa fa-twitter"></i></a></li>
							
							<li><a href="https://fb.com/themefisher"><i class="fa fa-dribbble"></i></a></li>
							
							<li><a href="https://fb.com/themefisher"><i class="fa fa-instagram"></i></a></li>
							
						</ul>
					</div>
				</div>
			</div>
			
		</div>
	</div>
</section>


<footer id="footer-bottom">
	<div class="container">
		<div class="row">
			<div class="col-md-12 col-sm-12">
				<div class="block">
					<p>Copyright 2020 - All Rights Reserved. Design and Developed By Themefisher.com</p>
				</div>
			</div>
		</div>
	</div>
</footer>

<!-- JS Plugins -->

<script src="http://bihai.org/js/jquery.min.js"></script>

<script src="http://bihai.org/js/bootstrap.min.js"></script>

<script src="http://bihai.org/js/slick.min.js"></script>

<script src="http://bihai.org/js/wow.min.js"></script>

<script src="http://bihai.org/js/venobox.min.js"></script>

<script src="http://bihai.org/js/main.js"></script>


<!-- google analitycs -->

<script>
	(function (i, s, o, g, r, a, m) {
		i['GoogleAnalyticsObject'] = r;
		i[r] = i[r] || function () {
			(i[r].q = i[r].q || []).push(arguments)
		}, i[r].l = 1 * new Date();
		a = s.createElement(o),
			m = s.getElementsByTagName(o)[0];
		a.async = 1;
		a.src = g;
		m.parentNode.insertBefore(a, m)
	})(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
	ga('create', 'Your ID', 'auto');
	ga('send', 'pageview');
</script>
</body>
</html>